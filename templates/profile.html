<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - SaaSPro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-header {
            background: white;
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .profile-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: #333;
        }
        .profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .info-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }
        .info-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        /* –ë–ª–æ–∫ —Å API –∫–ª—é—á–∞–º–∏ */
        .api-section {
            background: white;
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title i {
            color: #667eea;
        }
        
        /* –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ */
        .create-key-box {
            background: #f0f3ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: end;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∫–ª—é—á–µ */
        .new-key-alert {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        .raw-key {
            font-size: 16px;
            font-weight: bold;
            color: #28a745;
            word-break: break-all;
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .btn-copy {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π */
        .keys-list {
            display: grid;
            gap: 15px;
        }
        .key-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }
        .key-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .key-name {
            font-size: 16px;
            font-weight: 600;
        }
        .key-status {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        .status-active {
            background: #4caf50;
            color: white;
        }
        .key-hash {
            background: #e9ecef;
            padding: 8px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 13px;
            word-break: break-all;
            margin: 10px 0;
        }
        .btn-revoke {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: white;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-header">
            <h1 class="profile-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
            <div class="profile-info">
                <div class="info-card">
                    <div class="info-label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                    <div class="info-value" id="userId">test-user-123</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Email</div>
                    <div class="info-value" id="userEmail">user@example.com</div>
                </div>
                <div class="info-card">
                    <div class="info-label">–ü–æ–¥–ø–∏—Å–∫–∞</div>
                    <div class="info-value" id="userPlan">–ë–∞–∑–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ</div>
                </div>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ API –∫–ª—é—á–µ–π -->
        <div class="api-section">
            <div class="section-title">
                <i class="fas fa-key"></i> –ú–æ–∏ API –∫–ª—é—á–∏
            </div>

            <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∫–ª—é—á–µ -->
            <div class="new-key-alert" id="newKeyAlert">
                <strong>‚úÖ –ù–æ–≤—ã–π –∫–ª—é—á —Å–æ–∑–¥–∞–Ω! –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ:</strong>
                <div class="raw-key" id="rawKeyDisplay"></div>
                <button class="btn-copy" onclick="copyNewKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
            </div>

            <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞ -->
            <div class="create-key-box">
                <div class="form-row">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—é—á–∞</label>
                        <input type="text" id="keyName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Production" value="–ú–æ–π –∫–ª—é—á">
                    </div>
                    <div class="form-group">
                        <label>–õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤</label>
                        <input type="number" id="quotaLimit" value="1000">
                    </div>
                    <button class="btn-primary" onclick="createKey()">–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á</button>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π -->
            <div class="keys-list" id="keysList">
                <p style="text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>

        <a href="/dashboard-improved" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–∞—à–±–æ—Ä–¥</a>
    </div>

    <script>
        const userId = document.getElementById('userId').textContent;

        async function loadKeys() {
            const response = await fetch(`/api/user/keys?user_id=${userId}`);
            const data = await response.json();
            
            const keysList = document.getElementById('keysList');
            
            if (!data.keys || data.keys.length === 0) {
                keysList.innerHTML = '<p style="text-align: center; color: #666;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç API –∫–ª—é—á–µ–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–ª—é—á –≤—ã—à–µ.</p>';
                return;
            }

            keysList.innerHTML = data.keys.map(key => `
                <div class="key-card" id="key-${key.id}">
                    <div class="key-header">
                        <span class="key-name">${key.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</span>
                        <span class="key-status ${key.is_active ? 'status-active' : ''}">
                            ${key.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                        </span>
                    </div>
                    <div class="key-hash">${key.key_hash.substring(0, 30)}...</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <small>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${key.quota_used} / ${key.quota_limit}</small>
                        ${key.is_active ? 
                            `<button class="btn-revoke" onclick="revokeKey('${key.id}')">–û—Ç–æ–∑–≤–∞—Ç—å</button>` : 
                            ''}
                    </div>
                </div>
            `).join('');
        }

        async function createKey() {
            const name = document.getElementById('keyName').value;
            const quota = document.getElementById('quotaLimit').value;

            const response = await fetch('/api/keys/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: userId,
                    name: name,
                    quota_limit: parseInt(quota)
                })
            });

            const data = await response.json();
            
            if (data.success) {
                document.getElementById('newKeyAlert').style.display = 'block';
                document.getElementById('rawKeyDisplay').textContent = data.raw_key;
                document.getElementById('keyName').value = '–ú–æ–π –∫–ª—é—á';
                loadKeys();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + data.error);
            }
        }

        async function revokeKey(keyId) {
            if (!confirm('–û—Ç–æ–∑–≤–∞—Ç—å –∫–ª—é—á? –û–Ω –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.')) return;

            const response = await fetch('/api/keys/revoke', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ key_id: keyId })
            });

            const data = await response.json();
            if (data.success) {
                alert('‚úÖ –ö–ª—é—á –æ—Ç–æ–∑–≤–∞–Ω');
                loadKeys();
            } else {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + data.error);
            }
        }

        function copyNewKey() {
            const key = document.getElementById('rawKeyDisplay').textContent;
            navigator.clipboard.writeText(key);
            alert('‚úÖ –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
        }

        loadKeys();
    </script>
    <script src="https://kit.fontawesome.com/your-code.js" crossorigin="anonymous"></script>
</body>
</html>